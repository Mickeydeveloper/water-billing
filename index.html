<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Water Billing System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* CSS is largely preserved but with minor cleanup and new icon changes */
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #e0f7fa 0%, #b2f0e6 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .dashboard {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0002;
      padding: 36px 44px 30px 44px;
      max-width: 420px;
      width: 100%;
      text-align: center;
      position: relative;
      z-index: 1;
      perspective: 800px;
      /* Animation simplified for less distraction, but kept as requested */
      animation: rotate3d 6s infinite linear;
    }
    @keyframes rotate3d {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(8deg) rotateX(4deg); }
      100% { transform: rotateY(0deg) rotateX(0deg); }
    }
    h2 {
      color: #0077b6;
      margin-bottom: 18px;
    }
    .stat {
      margin: 14px 0; /* Reduced margin for new elements */
      font-size: 1.1em;
      color: #333;
      background: #e0f7fa;
      border-radius: 8px;
      padding: 10px 0; /* Reduced padding for new elements */
      box-shadow: 0 2px 8px #0077b622;
    }
    .open-login-btn {
      margin-top: 24px;
      padding: 12px 0;
      width: 100%;
      background: #0077b6;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 2px 8px #0077b633;
      transition: background 0.2s;
    }
    .open-login-btn:hover {
      background: #023e8a;
    }
    .icon {
      vertical-align: middle;
      margin-right: 8px;
    }
    .hacker-action {
      margin: 22px 0 0 0;
      padding: 12px 18px;
      background: #222;
      color: #0f0;
      font-family: 'Courier New', Courier, monospace;
      border-radius: 8px;
      font-size: 1.1em;
      box-shadow: 0 2px 8px #0005;
      text-align: center;
      letter-spacing: 1px;
      min-height: 32px;
    }
    #bubbleCanvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <canvas id="bubbleCanvas"></canvas>
  <div class="dashboard">
    <h2>Mickey System Dashboard</h2>
    <div style="width:100%;height:60px;overflow:hidden;position:relative;margin-bottom:18px;">
      <svg viewBox="0 0 500 60" preserveAspectRatio="none" style="width:100%;height:100%;position:absolute;left:0;top:0;">
        <path id="wavePath" d="M0,30 Q125,60 250,30 T500,30 V60 H0 Z" fill="#00b894" opacity="0.18">
          <animate attributeName="d" dur="3s" repeatCount="indefinite"
            values="M0,30 Q125,60 250,30 T500,30 V60 H0 Z;
                    M0,35 Q125,20 250,35 T500,35 V60 H0 Z;
                    M0,30 Q125,60 250,30 T500,30 V60 H0 Z" />
        </path>
      </svg>
    </div>
    
    <div class="stat" id="webStat"><span class="icon">üåê</span>Web Status: <span id="webStatus">Checking...</span></div>
    <div class="stat"><span class="icon">üíª</span>Your IP: <span id="ip">Loading...</span></div>
    <div class="stat"><span class="icon">üì∂</span>Internet Provider: <span id="isp">Loading...</span></div>
    
    <div class="stat"><span class="icon">üìç</span>Region: <span id="region">Loading...</span></div>
    <div class="stat"><span class="icon">üèôÔ∏è</span>District: <span id="district">Loading...</span></div>
    <div class="stat"><span class="icon">üèòÔ∏è</span>Ward: <span id="ward">Loading...</span></div>

    <div class="stat"><span class="icon">üîã</span>Battery: <span id="battery">Checking...</span></div>

    <button class="open-login-btn" onclick="window.location.href='login.html'">Open Login</button>
    <button class="open-login-btn" style="margin-top:10px;background:#25a244;" onclick="window.location.href='records.html'">Open Records</button>
    
    <div id="waterFact" style="margin-top:22px;font-size:1em;color:#0077b6;background:#e0f7fa;border-radius:8px;padding:12px 10px;box-shadow:0 2px 8px #0077b622;">
      Loading fun water fact...
    </div>
    <div class="hacker-action" id="hackerAction"></div>
  </div>
  <script>
    // --- UTILITIES & BUBBLE EFFECT (Kept) ---

    // Bubble effect code (unmodified)
    const canvas = document.getElementById('bubbleCanvas');
    const ctx = canvas.getContext('2d');
    let bubbles = [];
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    function createBubble() { /* ... implementation ... */ return { x: Math.random() * canvas.width, y: canvas.height + 20, r: 8 + Math.random() * 22, speed: 1 + Math.random() * 2, color: `rgba(0,${180+Math.random()*75},${255},${0.2+Math.random()*0.3})` }; }
    function drawBubbles() { /* ... implementation ... */ ctx.clearRect(0, 0, canvas.width, canvas.height); bubbles.forEach(b => { ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2); ctx.fillStyle = b.color; ctx.fill(); }); }
    function updateBubbles() { /* ... implementation ... */ bubbles.forEach(b => b.y -= b.speed); bubbles = bubbles.filter(b => b.y + b.r > 0); while (bubbles.length < 30) { bubbles.push(createBubble()); } }
    function animateBubbles() { /* ... implementation ... */ updateBubbles(); drawBubbles(); requestAnimationFrame(animateBubbles); }
    animateBubbles();

    // Fun water facts (unmodified)
    const facts = [
      "About 71% of the Earth's surface is water-covered.",
      "Water expands when it freezes, unlike most liquids.",
      "The human brain is about 75% water.",
      "Tanzania's Lake Victoria is the largest lake in Africa by area!",
      "Water can dissolve more substances than any other liquid."
    ];
    function showRandomFact() {
      const fact = facts[Math.floor(Math.random() * facts.length)];
      document.getElementById('waterFact').textContent = 'üíß ' + fact;
    }
    showRandomFact();
    setInterval(showRandomFact, 12000);

    // --- SYSTEM STATUS CHECKS ---

    // Web status (unmodified)
    document.getElementById('webStatus').textContent = navigator.onLine ? 'Online' : 'Offline';
    window.addEventListener('online', () => document.getElementById('webStatus').textContent = 'Online');
    window.addEventListener('offline', () => document.getElementById('webStatus').textContent = 'Offline');

    // Battery status (unmodified)
    if (navigator.getBattery) {
      navigator.getBattery().then(function(battery) {
        function updateBattery() {
          let level = Math.round(battery.level * 100) + '%';
          let charging = battery.charging ? ' (Charging)' : '';
          document.getElementById('battery').textContent = level + charging;
        }
        updateBattery();
        battery.addEventListener('levelchange', updateBattery);
        battery.addEventListener('chargingchange', updateBattery);
      });
    } else {
      document.getElementById('battery').textContent = 'Not supported';
    }
    
    // --- LOCATION & NETWORK VIA IP GEOLOCATION API ---
    
    /**
     * Fetches IP, ISP, and Location data using a public API.
     * The API fields are mapped to your required Tanzanian administrative units.
     * City -> Ward (Local Area)
     * RegionName -> District (Administrative Region)
     * Country -> Region (Top-level area, often 'Tanzania')
     */
    function fetchLocationAndNetwork() {
        const ipApiUrl = 'http://ip-api.com/json/?fields=status,message,country,regionName,city,isp,query';

        fetch(ipApiUrl)
            .then(res => {
                if (!res.ok) throw new Error('API request failed');
                return res.json();
            })
            .then(data => {
                if (data.status === 'fail') {
                    console.error('IP-API Failed:', data.message);
                    document.getElementById('ip').textContent = 'Unavailable';
                    document.getElementById('isp').textContent = 'Unavailable';
                    document.getElementById('region').textContent = 'Unavailable';
                    document.getElementById('district').textContent = 'Unavailable';
                    document.getElementById('ward').textContent = 'Unavailable';
                    return;
                }
                
                // MAPPING API FIELDS TO YOUR REQUIREMENTS:
                // isp -> Internet Provider
                // query (IP) -> Your IP
                // country -> Region (Top-level)
                // regionName -> District
                // city -> Ward
                
                document.getElementById('ip').textContent = data.query || 'N/A';
                document.getElementById('isp').textContent = data.isp || 'N/A';
                
                // Location Data
                document.getElementById('region').textContent = data.country || 'N/A'; 
                document.getElementById('district').textContent = data.regionName || 'N/A';
                document.getElementById('ward').textContent = data.city || 'N/A';
            })
            .catch(error => {
                console.error("Geolocation Error:", error);
                document.getElementById('ip').textContent = 'Error Fetching IP';
                document.getElementById('isp').textContent = 'Error Fetching ISP';
                document.getElementById('region').textContent = 'Error';
                document.getElementById('district').textContent = 'Error';
                document.getElementById('ward').textContent = 'Error';
            });
    }

    fetchLocationAndNetwork(); // Run the new function

    // --- REMOVED: Camera Status, Storage Status, Network Type (replaced by fetchLocationAndNetwork) ---
    // The previous code for network, camera, and storage has been deleted.

    // Hacker action effect (modified texts)
    const hackerAction = document.getElementById('hackerAction');
    const hackerTexts = [
      'Initializing system scan..._'
      ,'Fetching real-time location..._'
      ,'Identifying Internet Provider..._'
      ,'Mapping IP to Dar es Salaam..._'
      ,'All systems secure!_'
      ,'Tip: Water flows, code runs!_'
      ,'Lead: Mickey "Hacker" Hamza_'
    ];
    let hackerIndex = 0;
    let charIndex = 0;
    function typeHackerAction() {
      if (charIndex <= hackerTexts[hackerIndex].length) {
        hackerAction.textContent = hackerTexts[hackerIndex].slice(0, charIndex) + (charIndex % 2 ? '_' : '');
        charIndex++;
        setTimeout(typeHackerAction, 60);
      } else {
        setTimeout(() => {
          hackerIndex = (hackerIndex + 1) % hackerTexts.length;
          charIndex = 0;
          typeHackerAction();
        }, 1200);
      }
    }
    typeHackerAction();
  </script>
</body>
</html>
