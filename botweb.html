<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NIDA - Tuma WhatsApp, SMS & PDF</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: system-ui; background: #f0f9ff; padding: 20px; }
    input { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ccc; border-radius: 12px; font-size: 16px; }
    button { padding: 16px; margin: 10px 0; border: none; border-radius: 12px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; }
    .save { background: #10b981; }
    .wa { background: #25d366; }
    .sms { background: #6366f1; }
    .pdf { background: #ef4444; }
    .share-pdf { background: #8b5cf6; }
  </style>
</head>
<body>

<h1 class="text-center text-3xl font-bold text-indigo-800 mb-6">NIDA / TIN Info</h1>

<div class="bg-white p-6 rounded-2xl shadow-xl">
  <input type="text" id="nida" placeholder="1. Namba ya NIDA">
  <input type="text" id="phone" placeholder="2. Namba ya simu">
  <input type="text" id="mother" placeholder="3. Majina matatu ya mama">
  <input type="text" id="primarySchool" placeholder="4. Shule ya msingi">
  <input type="text" id="year" placeholder="5. Mwaka uliomaliza darasa la saba">
  <input type="text" id="regionPrimary" placeholder="6. Wilaya uliyohitimu darasa la saba">
  <input type="text" id="currentRegion" placeholder="7. Wilaya unayoishi sasa">

  <button class="save w-full" id="generate">Hifadhi & Tuma</button>
</div>

<div id="buttons"></div>

<script>
  document.getElementById('generate').onclick = async () => {
    const data = {
      nida: document.getElementById('nida').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      motherName: document.getElementById('mother').value.trim(),
      primarySchool: document.getElementById('primarySchool').value.trim(),
      yearCompleted: document.getElementById('year').value.trim(),
      regionPrimary: document.getElementById('regionPrimary').value.trim(),
      currentRegion: document.getElementById('currentRegion').value.trim(),
    };

    if (!data.nida || !data.motherName || !data.primarySchool) {
      return alert("Jaza NIDA, jina la mama na shule ya msingi kwanza!");
    }

    // Create plain text message
    const text = `TAARIFA ZA NIDA\n\n` +
      `Namba ya NIDA: ${data.nida}\n` +
      `Simu: ${data.phone}\n` +
      `Majina ya Mama: ${data.motherName}\n` +
      `Shule ya Msingi: ${data.primarySchool}\n` +
      `Mwaka: ${data.yearCompleted}\n` +
      `Wilaya ya Shule: ${data.regionPrimary}\n` +
      `Wilaya Unayoishi: ${data.currentRegion}\n\n` +
      `Imehifadhiwa: ${new Date().toLocaleString('sw-TZ')}`;

    // Generate PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.text("TAARIFA ZA NIDA", 105, 20, null, null, "center");
    doc.setFontSize(14);
    let y = 40;
    Object.entries(data).forEach(([k, v]) => {
      if (v) {
        const labels = {
          nida: "Namba ya NIDA", phone: "Simu", motherName: "Majina ya Mama",
          primarySchool: "Shule ya Msingi", yearCompleted: "Mwaka", 
          regionPrimary: "Wilaya ya Shule", currentRegion: "Wilaya Unayoishi"
        };
        doc.text(`\( {labels[k]}: \){v}`, 20, y);
        y += 12;
      }
    });
    const pdfBlob = doc.output('blob');
    const pdfUrl = URL.createObjectURL(pdfBlob);

    // Show working buttons
    document.getElementById('buttons').innerHTML = `
      <div class="mt-6 space-y-4">
        <button class="wa w-full" onclick="window.location.href='https://wa.me/?text=${encodeURIComponent(text)}'">
          Tuma WhatsApp (Text)
        </button>
        
        <button class="share-pdf w-full" onclick="shareFile('\( {pdfUrl}', 'NIDA_Info_ \){data.nida}.pdf', 'application/pdf')">
          Tuma PDF kwa WhatsApp / Apps Zingine
        </button>
        
        <button class="sms w-full" onclick="window.location.href='sms:?body=${encodeURIComponent(text)}'">
          Tuma SMS (Android)
        </button>
        
        <button class="pdf w-full" onclick="downloadPDF()">
          Pakua PDF (Hifadhi kwenye Simu)
        </button>
      </div>
    `;

    // Download PDF function
    window.downloadPDF = () => {
      const a = document.createElement('a');
      a.href = pdfUrl;
      a.download = `NIDA_\( {data.nida}_ \){new Date().toISOString().slice(0,10)}.pdf`;
      a.click();
    };

    // Universal share function (works perfectly on Android)
    window.shareFile = async (url, filename, type) => {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        const file = new File([blob], filename, { type });
        
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({ files: [file], title: 'Taarifa za NIDA' });
        } else {
          // Fallback: open WhatsApp with attachment via Web Share (most phones)
          window.location.href = `https://wa.me/?text=${encodeURIComponent("Hii ni taarifa za NIDA")}`;
          setTimeout(() => alert("Chagua PDF kutoka gallery yako"), 2000);
        }
      } catch (e) {
        alert("Share haikufanikiwa. Tumia 'Pakua PDF' kisha tuma kwa mkono");
      }
    };
  };
</script>

</body>
</html>