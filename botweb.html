<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Player</title>

<style>
/* ‚úÖ MODERN UI THEME (All CSS Here) */
:root {
    --bg: #0b0f15;
    --card: #131a24;
    --accent: #00ffc6;
    --text: #eef6ff;
    --muted: #7d8da5;
}
* {
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
}
body {
    margin: 0;
    background: radial-gradient(circle at top, #0b141f, #000);
    color: var(--text);
    display: flex;
    justify-content: center;
    padding: 20px;
}
.container {
    width: 100%;
    max-width: 500px;
    text-align: center;
}
.card {
    background: var(--card);
    border-radius: 18px;
    padding: 20px;
    box-shadow: 0 0 40px rgba(0,255,199,0.12);
}
input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: #1c2735;
    color: var(--text);
    outline: none;
}
button {
    width: 100%;
    margin-top: 12px;
    padding: 14px;
    border-radius: 10px;
    border: none;
    background: var(--accent);
    color: #000;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}
button:hover {
    opacity: .85;
}
.status {
    margin-top: 10px;
    color: var(--muted);
}
audio {
    width: 100%;
    margin-top: 18px;
}
#downloadBtn {
    display: none;
    margin-top: 12px;
}
</style>
</head>

<body>
<div class="container">
    <h2>üéµ Music Search & Player</h2>

    <div class="card">
        <input id="song" type="text" placeholder="Search audio... (Example: Adele Hello)">
        <button onclick="playMusic()">PLAY MUSIC</button>

        <div id="status" class="status">Idle...</div>

        <audio id="audioPlayer" controls></audio>
        
        <button id="downloadBtn" onclick="downloadAudio()">DOWNLOAD AUDIO</button>
    </div>
</div>

<script>
/* ‚úÖ ALL JS HERE */
let currentAudioURL = '';

async function playMusic() {
    const audioPlayer = document.getElementById("audioPlayer");
    const songName = document.getElementById("song").value.trim();
    const status = document.getElementById("status");
    const downloadBtn = document.getElementById("downloadBtn");

    if (!songName) {
        status.innerText = "‚ö†Ô∏è Enter song name first";
        return;
    }

    status.innerText = "‚è≥ Searching song...";

    try {
        // ‚úÖ Vreden API search with added headers to potentially bypass issues
        const apiURL = `https://api.vreden.my.id/api/v1/download/play/audio?query=${encodeURIComponent(songName)}`;
        const res = await fetch(apiURL, {
            method: 'GET',
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
            }
        });

        if (!res.ok) throw new Error("API failed");

        const data = await res.json();
        const audioURL = data?.result?.url;

        if (!audioURL) {
            status.innerText = "‚ùå Audio not found!";
            downloadBtn.style.display = 'none';
            return;
        }

        currentAudioURL = audioURL;
        status.innerText = "‚úÖ Playing...";
        audioPlayer.src = audioURL;
        await audioPlayer.play();
        downloadBtn.style.display = 'block';

    } catch (error) {
        // Improved error handling for "Failed to fetch"
        if (error.message === 'Failed to fetch') {
            status.innerText = "‚ùå Network error: Check your internet or run this on a local server (e.g., using VS Code Live Server) to avoid CORS issues.";
        } else {
            status.innerText = "‚ùå Error: " + error.message;
        }
        console.error(error);
        downloadBtn.style.display = 'none';
    }
}

function downloadAudio() {
    if (currentAudioURL) {
        const link = document.createElement('a');
        link.href = currentAudioURL;
        link.download = 'audio.mp3'; // You can customize the filename
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
}
</script>

</body>
</html>
