<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekodi za Data Zilizoboreshwa - Graphy</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap">
    <style>
        :root {
            --primary-color: #1e40af;
            --secondary-color: #0ea5e9;
            --success-color: #10b981;
            --error-color: #ef4444;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        body {
            font-family: 'Poppins', Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: inherit;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .add-btn {
            background: linear-gradient(135deg, var(--success-color), #059669);
        }
        
        .add-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, var(--error-color), #dc2626);
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #dc2626, #991b1b);
        }
        
        #data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        #data-table th, #data-table td {
            border: 1px solid var(--border-color);
            padding: 1rem;
            text-align: left;
            min-width: 60px;
        }
        
        #data-table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85rem;
        }
        
        .editable {
            background-color: rgba(14, 165, 233, 0.05);
        }
        
        #status-message {
            text-align: center;
            margin-top: 1rem;
            font-weight: 600;
            min-height: 25px;
            color: var(--success-color);
        }
        
        /* MEGA styles removed (cloud backup disabled) */
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Rekodi za Data Zilizoboreshwa (Graphy)</h1>

    <div class="controls">
        <button onclick="saveData()">Hifadhi Mabadiliko (Save)</button>
        <button class="add-btn" onclick="addRecord()">‚ûï Ongeza Mtu/Rekodi</button>
        <button class="add-btn" onclick="addColumn()">‚ûï Ongeza Mwezi/Safu Wima</button>
        <button class="reset-btn" onclick="resetData()">‚ôªÔ∏è Anzisha Upya (Reset)</button>
    </div>

    <!-- MEGA UI removed: cloud backup functionality has been disabled -->

    <div id="status-message"></div>

    <div style="overflow-x:auto;">
        <table id="data-table">
            <thead>
                <tr id="table-header-row">
                    <th>JINA</th>
                    </tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>

    <script>
        // MEGA integration removed ‚Äî the following functions are retained as no-ops to keep UI stable
        const initialData = [];
        const initialHeaders = [];
        const localStorageKey = 'recordDataEnhanced';
        const localStorageHeadersKey = 'recordHeadersEnhanced';
        const tableBody = document.getElementById('table-body');
        const tableHeaderRow = document.getElementById('table-header-row');
        const statusMessage = document.getElementById('status-message');




        function loadData() {
            const savedData = localStorage.getItem(localStorageKey);
            const savedHeaders = localStorage.getItem(localStorageHeadersKey);
            let data = initialData;
            let headers = initialHeaders;
            if (savedData && savedHeaders) {
                try { data = JSON.parse(savedData); headers = JSON.parse(savedHeaders); showMessage("Data iliyohifadhiwa imepakiwa.", "green"); }
                catch (e) { showMessage("Hitilafu katika kupakia data iliyohifadhiwa. Data ya awali inatumika.", "red"); }
            } else {
                localStorage.setItem(localStorageHeadersKey, JSON.stringify(initialHeaders));
                localStorage.setItem(localStorageKey, JSON.stringify(initialData));
                showMessage("Imeanzishwa bila rekodi (meza tupu). Ongeza watu/kolamu na uhifadhi.", "blue");
            }
            renderTable(data, headers);
        }

        function renderTable(data, headers) {
            tableHeaderRow.innerHTML = '<th>JINA</th>';
            headers.forEach((header, colIndex) => {
                const th = document.createElement('th');
                th.setAttribute('contenteditable', 'true');
                th.innerHTML = `${header} <button class="col-del" data-col="${colIndex}">‚úñ</button>`;
                tableHeaderRow.appendChild(th);
            });
            const actionsTh = document.createElement('th'); actionsTh.textContent = 'TINYAGO'; tableHeaderRow.appendChild(actionsTh);
            tableBody.innerHTML = '';
            data.forEach(item => {
                const row = tableBody.insertRow();
                let nameCell = row.insertCell(); nameCell.textContent = item.JINA || ''; nameCell.setAttribute('contenteditable', 'true');
                headers.forEach(header => { let scoreCell = row.insertCell(); scoreCell.textContent = item[header] !== undefined ? item[header] : ''; scoreCell.setAttribute('contenteditable', 'true'); scoreCell.classList.add('editable'); });
                const actionCell = row.insertCell(); const delBtn = document.createElement('button'); delBtn.textContent = 'Futa'; delBtn.style.background = '#e74c3c'; delBtn.style.color = '#fff'; delBtn.style.border = 'none'; delBtn.style.padding = '6px 8px'; delBtn.style.borderRadius = '4px';
                delBtn.addEventListener('click', () => { if (confirm('Una uhakika unataka kufuta rekodi hii?')) { row.remove(); saveData(); showMessage('Rekodi imefutwa.', 'orange'); } });
                actionCell.appendChild(delBtn);
            });
            document.querySelectorAll('#table-header-row th[contenteditable="true"]').forEach(th => { th.addEventListener('blur', updateHeadersInLocalStorage); });
            document.querySelectorAll('.col-del').forEach(btn => { btn.addEventListener('click', (e) => { const colIndex = parseInt(e.currentTarget.getAttribute('data-col')); if (confirm('Una uhakika unataka kufuta safu hii (kolamu)?')) { deleteColumnByIndex(colIndex); } }); });
        }

        function saveData() {
            const { data, headers } = getTableData();
            try {
                localStorage.setItem(localStorageKey, JSON.stringify(data));
                localStorage.setItem(localStorageHeadersKey, JSON.stringify(headers));
                showMessage("‚úÖ Mabadiliko yamehifadhiwa kwa ufanisi!", "green");
            } catch (e) {
                // improved error reporting
                showMessage("‚ùå Kushindwa kuhifadhi. Kosa: " + (e && e.message ? e.message : String(e)), "red");
            }
        }

        function getTableData() {
            const data = [];
            const rows = tableBody.querySelectorAll('tr');
            const headerCells = tableHeaderRow.querySelectorAll('th');
            const headers = Array.from(headerCells).map(th => th.textContent.trim()).filter(h => h && h !== 'JINA');
            rows.forEach(row => { const cells = row.querySelectorAll('td'); const rowData = {}; if (cells.length > 0) { rowData['JINA'] = cells[0].textContent.trim(); headers.forEach((header, index) => { if (cells[index + 1]) { rowData[header] = cells[index + 1].textContent.trim(); } }); data.push(rowData); } });
            return { data, headers };
        }

        function updateHeadersInLocalStorage() { const { data, headers } = getTableData(); localStorage.setItem(localStorageHeadersKey, JSON.stringify(headers)); }

        function resetData() { if (confirm("Uko karibu kufuta data yote iliyohifadhiwa na kurudi kwenye data ya awali. Una uhakika?")) { localStorage.removeItem(localStorageKey); localStorage.removeItem(localStorageHeadersKey); loadData(); showMessage("Data imefutwa na kurudishwa kwenye hali ya awali.", "orange"); } }
        function clearData() { resetData(); }
        function showMessage(msg, color) { statusMessage.textContent = msg; statusMessage.style.color = color; setTimeout(() => { statusMessage.textContent = ''; }, 4000); }

        function addRecord() { const currentHeaders = getTableData().headers; const row = tableBody.insertRow(); let nameCell = row.insertCell(); nameCell.textContent = "Jina Jipya"; nameCell.setAttribute('contenteditable', 'true'); currentHeaders.forEach(() => { let scoreCell = row.insertCell(); scoreCell.textContent = ""; scoreCell.setAttribute('contenteditable', 'true'); scoreCell.classList.add('editable'); }); saveData(); showMessage("Rekodi mpya imeongezwa.", "blue"); }

        function addColumn() { const { data, headers } = getTableData(); let newHeaderNumber = 1; if (headers.length > 0) { const numericHeaders = headers.map(h => parseInt(h)).filter(n => !isNaN(n)); if (numericHeaders.length > 0) { newHeaderNumber = Math.max(...numericHeaders) + 1; } } const newHeader = String(newHeaderNumber); headers.push(newHeader); data.forEach(item => { item[newHeader] = ''; }); renderTable(data, headers); saveData(); showMessage(`Mwezi/Safu Wima '${newHeader}' imeongezwa.`, "blue"); }

        function deleteColumnByIndex(colIndex) { const { data, headers } = getTableData(); if (colIndex < 0 || colIndex >= headers.length) return; const headerToRemove = headers[colIndex]; headers.splice(colIndex, 1); data.forEach(item => { delete item[headerToRemove]; }); renderTable(data, headers); saveData(); showMessage(`Safu '${headerToRemove}' imefutwa.`, 'orange'); }

        // Cloud backup removed from this page; MEGA functions deleted
        // If cloud backups are reintroduced, implement a secure provider and UI.

        window.onload = loadData;
    </script>

</body>
</html>