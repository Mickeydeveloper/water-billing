<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Passive AI Face Login</title>
  <style>
    /* ---------------------------------- */
    /* BASIC STYLING */
    /* ---------------------------------- */
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #2c3e50;
      color: #ecf0f1;
    }
    .container {
      text-align: center;
      background: #34495e;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease-in-out; /* For shake/pulse effect */
    }
    h1 {
        margin-top: 0;
    }
    /* HIDE THE CAMERA VIDEO FEED */
    video {
      /* This is the key change: Hide the live feed but keep it running */
      display: none; 
      /* Make sure it has dimensions for capture */
      width: 320px; 
      height: 240px;
    }
    /* Show the captured photo */
    #photoCanvas {
      display: none; 
      margin: 15px auto;
      border-radius: 10px;
      border: 3px solid #3498db;
    }
    .caption {
      color: #bdc3c7;
      font-size: 0.8em;
    }
    .status {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
      min-height: 30px;
      color: #3498db;
    }
    /* Hide the button */
    button { display: none; }

    /* ---------------------------------- */
    /* EFFECTS/ANIMATIONS (New Features) */
    /* ---------------------------------- */
    /* Pulse effect for status during recognition */
    @keyframes pulse-scan {
      0% { box-shadow: 0 0 5px rgba(52, 152, 219, 0.4); }
      50% { box-shadow: 0 0 15px rgba(52, 152, 219, 0.8), 0 0 30px rgba(52, 152, 219, 0.4); }
      100% { box-shadow: 0 0 5px rgba(52, 152, 219, 0.4); }
    }
    .scanning {
        animation: pulse-scan 1.5s infinite ease-in-out;
    }

    /* Quick flash effect on the canvas when the photo is taken */
    @keyframes photo-flash {
        0% { opacity: 0; }
        50% { opacity: 1; filter: brightness(2); }
        100% { opacity: 1; filter: brightness(1); }
    }
    .flash {
        animation: photo-flash 0.3s ease-out;
    }
    
  </style>
</head>
<body>
  <div class="container" id="loginContainer">
    <h1>Passive AI Login üïµÔ∏è</h1>
    <div class="caption">Looking for an authorized user...</div>
    
    <video id="camera" width="320" height="240" autoplay muted></video>
    
    <canvas id="photoCanvas" width="320" height="240"></canvas>
    <div class="caption" id="canvasCaption"></div>
    
    <div class="status" id="status">Starting camera...</div>
  </div>
  
  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('photoCanvas');
    const statusText = document.getElementById('status');
    const container = document.getElementById('loginContainer');
    const canvasCaption = document.getElementById('canvasCaption');
    const context = canvas.getContext('2d');
    
    let loginAttempted = false;

    // --- 1. Start Camera Stream ---
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
        statusText.textContent = "Camera active. Awaiting face signal...";
        
        video.onloadedmetadata = () => {
            video.play();
            // Start the AI simulation loop once the video is playing
            setTimeout(simulateAILoop, 1000); 
        };
      })
      .catch(err => {
        statusText.style.color = 'red';
        statusText.textContent = "üö® Camera access failed. Biometric login unavailable.";
        console.error("Camera Error:", err);
      });

    // --- 2. AI Recognition Simulation Loop ---
    function simulateAILoop() {
      if (loginAttempted) return;

      // Add the visual scanning effect
      container.classList.add('scanning');

      // Simulate a successful face detection after a short delay
      setTimeout(() => {
        // --- STEP 1: Face Detected (AI Success) ---
        statusText.style.color = '#2ecc71';
        statusText.textContent = "‚úÖ Face detected! Analyzing biometric profile...";
        container.classList.remove('scanning'); // Stop pulsing
        
        // Simulate the AI processing delay before logging in
        setTimeout(performAutoLogin, 1500); 
        
      }, 2000); // Wait 2 seconds before "detecting" the face
    }

    // --- 3. Automatic Photo Capture and Login ---
    function performAutoLogin() {
        if (loginAttempted) return;
        loginAttempted = true;

        // Take the photo
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // Show the captured photo and add flash effect
        canvas.style.display = 'block';
        canvas.classList.add('flash');
        canvasCaption.textContent = "Captured Image for Verification";
        
        statusText.style.color = '#3498db';
        statusText.textContent = "üì∏ Photo Captured. Verifying and Logging in...";
        
        // Simulate server login/verification time
        setTimeout(() => {
          // *** Success Redirect ***
          statusText.style.color = '#2ecc71';
          statusText.textContent = "üîë Login Successful! Redirecting...";
          
          // Clean up the camera stream
          if (video.srcObject) {
              video.srcObject.getTracks().forEach(track => track.stop());
          }
          
          window.location.href = "main.html";
        }, 1500);
    }
  </script>
</body>
</html>
